@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.AspNetCore.Identity
@model Swarojgaar.ViewModel.HomeIndexVM.HomeIndexVM
@using Microsoft.AspNetCore.Identity
@using Swarojgaar.Data
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@inject ApplicationDbContext _dbContext
@{
    ViewData["Title"] = "Home";
}
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<div class="container py-6">
    <div class="row flex-lg-row-reverse align-items-center g-5">
        <div class="col-10 mx-auto col-sm-8 col-lg-6">
            <img src="\images\employer-login.svg" class="d-block mx-lg-auto img-fluid" loading="lazy">
        </div>
        <div class="col-lg-6">
            <div class="lc-block mb-3">
                <div editable="rich">
                    <h2 class="fw-bold display-5">Connecting Talent With</h2>
                    <h1 class="fw-bold display-1" style="color: #0d6efd">Opportunities</h1>
                </div>
            </div>

            <div class="lc-block mb-3">
                <div editable="rich">
                    <p class="lead">
                        Welcome to <b>Swarojgaar,</b> where opportunities meet aspirations, and careers take flight! We understand that your journey towards professional success is unique, and that's why Swarojgaar is not just a job portal; it's your personal gateway to a world of possibilities.
                    </p>
                </div>
            </div>
            @if (!SignInManager.IsSignedIn(User))
            {
                <div class="lc-block d-grid gap-2 d-md-flex justify-content-md-start">
                    <a class="btn btn-primary px-4 me-md-2" role="button" id="register" asp-area="Identity" asp-page="/Account/Register">Register Now!</a>
                    <a class="btn btn-outline-success px-4" role="button" id="login" asp-area="Identity" asp-page="/Account/Login">Login</a>
                </div>
            }
        </div>
    </div>
</div>

<div>
    @await Html.PartialAsync("_GetRecommendedJobs", Model.RecommendedJobs)
</div>

<div class="d-flex align-items-center">
    <h1 style="margin-left: 12px; margin-right: 10px">Hot Jobs🔥</h1>
    <div class="search-container d-flex align-items-center">
        <form id="searchForm" class="d-flex me-3">
            <input id="searchInput" class="form-control mr-sm-2" type="search" placeholder="Search Jobs" aria-label="Search" name="search_item" style="height: 2.7em; width: 400px">
            <button id="searchButton" class="btn btn-outline-success my-2 my-sm-0" type="submit"><i class="fas fa-search"></i> Search</button>
        </form>

        <div class="dropdown">
            <button class="btn btn-success dropdown-toggle" type="button" id="categoryDropdown" style="height: 2.7em;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Select Category
            </button>
            <div class="dropdown-menu" aria-labelledby="categoryDropdown">
                <a class="dropdown-item" href="#" data-category-id="0">All Jobs</a>
                @foreach (var category in _dbContext.Categories)
                {
                    <a class="dropdown-item" href="#" data-category-id="@category.CategoryId">@category.CategoryName</a>
                }
            </div>
        </div>
    </div>
</div>

<div id="jobListContainer">
    @await Html.PartialAsync("_JobListPartial", Model.ActiveJobs)
</div>
<script src="lib/jquery/dist/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#categoryDropdown').on('click', function () {
            $(this).next('.dropdown-menu').toggle();
        });
    });
</script>
<script>
    $(document).ready(function () {
        $("#searchInput").on("input", function () {
            searchJobs();
        });

        function searchJobs(categoryId = null) {
            var searchItem = $("#searchInput").val();

            $.ajax({
                url: "/Home/SearchJobs",
                data: {
                    search_item: searchItem,
                    categoryId: categoryId
                },
                type: "GET",
                success: function (result) {
                    $("#jobListContainer").html(result);
                },
                error: function (error) {
                    console.error("Error searching jobs: " + error.responseText);
                }
            });
        }

        $('.dropdown-menu a.dropdown-item').click(function (e) {
            e.preventDefault(); // Prevent the default link behavior

            var categoryId = $(this).data('category-id');
            searchJobs(categoryId);
        });
    });
</script>