@using System.Security.Claims
@using Swarojgaar.Data
@model List<Swarojgaar.ViewModel.SavedJobVM.GetAllSavedJobsVM>
@inject ApplicationDbContext _dbContext
@inject Microsoft.AspNetCore.Identity.UserManager<User> UserManager

@if (TempData["ResultOk"] != null)
{
    <script src="/lib/jquery/dist/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script type="text/javascript">
        toastr.success('@TempData["ResultOk"]');
    </script>
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
@if (TempData["ResultNotOk"] != null)
{
    <script src="/lib/jquery/dist/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script type="text/javascript">
        toastr.error('@TempData["ResultNotOk"]');
    </script>
}

@{
    // Get the current user's information
    var userId = Context.User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    var userSavedJobs = Model.Where(x => x.UserId == userId)
        .Where(savedJob => !_dbContext.JobApplications.Any(ja => ja.JobId == savedJob.JobId && ja.UserId == userId))
        .ToList();
}
<h2>Your Saved Jobs</h2>
<hr/>
@if (userSavedJobs.Any())
{
    <table class="table table-striped table-bordered table-hover" style="background-color: white">

        <thead class="table-warning">
            <tr>
                <th>
                    Organization
                </th>
                <th>
                    Location
                </th>
                <th>
                    Email
                </th>
                <th>
                    Contact Number
                </th>
                <th>
                    Title
                </th>
                <th>
                    Summary
                </th>
                <th>
                    Salary
                </th>
                <th>
                    Action
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in userSavedJobs)
            {
                var currentJob = await _dbContext.Jobs.FindAsync(item.JobId);
                var currentCompany = await UserManager.FindByIdAsync(currentJob.UserId);
                <try>
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => currentCompany.FirstName)
                            @Html.DisplayFor(modelItem => currentCompany.LastName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => currentCompany.Location)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => currentCompany.Email)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => currentCompany.PhoneNumber)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Title)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.JobSummary)

                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Salary)
                        </td>
                        <td>
                            <input type="hidden" name="savedJobId" value="@item.SavedJobId">
                            <a asp-controller="SaveJob" asp-action="ApplyAndRemove" asp-route-savedJobId="@item.SavedJobId" class="btn btn-success"><i class="far fa-check-circle"></i> Apply</a>
                            <a asp-controller="SaveJob" asp-action="DeleteSavedJob" asp-route-savedJobId="@item.SavedJobId" class="btn btn-danger"><i class="far fa-trash-alt"></i> Delete</a>
                        </td>
                    </tr>
                </try>
            }
        </tbody>
    </table>
}
@* <nav aria-label="Page navigation example">
    <ul class="pagination">
        <li class="page-item"><a class="page-link" href="#">Previous</a></li>
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item"><a class="page-link" href="#">Next</a></li>
    </ul>
</nav> *@