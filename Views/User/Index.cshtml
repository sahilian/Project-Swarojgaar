@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<User>
@inject UserManager<User> _userManager

<div class="alert alert-success" style="text-align: center">
    <h2>List of all registered users:</h2>
    <h2 class="btn btn-success">Total Users: @Model.Count()</h2>
    <h2 class="btn btn-danger">Admins: @Model.Count(u => _userManager.IsInRoleAsync(u, "Admin").Result)</h2>
    <h2 class="btn btn-primary">Job Seekers: @Model.Count(u => _userManager.IsInRoleAsync(u, "Job_Seeker").Result)</h2>
    <h2 class="btn btn-warning">Job Providers: @Model.Count(u => _userManager.IsInRoleAsync(u, "Job_Provider").Result)</h2>
</div>


<table class="table table-striped table-bordered table-hover" style="background-color: white">
    <thead class="table-warning">
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Location</th>
            <th>Contact Number</th>
            <th>Roles</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            @if (!await _userManager.IsInRoleAsync(user, "Admin"))
            {
                <tr>
                    <td>@user.FirstName @user.LastName</td>
                    <td>@user.Email</td>
                    <td>@user.Location</td>
                    <td>@user.PhoneNumber</td>
                    <td>
                        @foreach (var role in await _userManager.GetRolesAsync(user))
                        {
                            // Display roles as buttons
                            <button type="button" class="@GetButtonClass(role)" style="width: 115px">@role</button>
                        }
                    </td>
                    <td>
                        @if (await _userManager.IsInRoleAsync(user, "Admin"))
                        {
                            <a asp-action="Details" asp-route-id="@user.Id" class="btn btn-primary" style="width: 150px">Details</a>
                        }
                        else
                        {
                            <a asp-action="Details" asp-route-id="@user.Id" class="btn btn-primary">Details</a>
                        }
                        @if (!await _userManager.IsInRoleAsync(user, "Admin"))
                        {
                            <a asp-action="Delete" asp-route-id="@user.Id" class="btn btn-danger">Delete</a>
                        }
                    </td>
                </tr>
            }
            
        }
    </tbody>
</table>

@* Helper method to determine the button class based on the role *@
@functions {
    string GetButtonClass(string role)
    {
        switch (role)
        {
            case "Admin":
                return "btn btn-outline-danger";
            case "Job_Provider":
                return "btn btn-outline-primary";
            case "Job_Seeker":
                return "btn btn-outline-success";
            default:
                return "btn btn-outline-secondary";
        }
    }
}