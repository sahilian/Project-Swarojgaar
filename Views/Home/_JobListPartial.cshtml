@* @model List<Swarojgaar.ViewModel.JobVM.GetAllJobsVM>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css"/>

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-lg-4 col-md-1 col-sm-4 col-xs-1">
            <div class="box-part text-center cards">
                <h1>🔥</h1>
                <div class="title">
                    <h4>@Html.DisplayFor(modelItem => item.Title)</h4>
                </div>
                <div class="text">
                    <span>@Html.DisplayFor(modelItem => item.Description)</span>
                </div>
                <div role="group" class="w-60 btn-group">
                    <a asp-controller="SaveJob" asp-action="SaveJob" asp-route-id="@item.JobId" class="btn btn-primary mx-1 rounded">Save</a>
                    <a asp-controller="JobApplication" asp-action="CreateJobApplication" asp-route-id="@item.JobId" class="btn btn-success mx-1 rounded">Apply</a>
                </div>
            </div>
        </div>
    }
</div>

 *@

@using System.Security.Claims
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Swarojgaar.Data
@model List<Swarojgaar.ViewModel.JobVM.GetAllJobsVM>
@inject ApplicationDbContext _dbContext
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-lg-4 col-md-1 col-sm-4 col-xs-1">
            <div class="box-part text-center cards">
                <h1>🔥</h1>
                <div class="title">
                    <h4>@Html.DisplayFor(modelItem => item.Title)</h4>
                </div>
                <div class="text">
                    <span>@Html.DisplayFor(modelItem => item.Description)</span>
                </div>
                <div role="group" class="w-60 btn-group">
                    @if (User.Identity.IsAuthenticated)
                    {
                        var hasApplied = CheckIfUserApplied(item.JobId); // Implement this function to check if the user has applied
                        if (hasApplied)
                        {
                            <a class="btn btn-success mx-1 rounded" asp-controller="JobApplication" asp-action="Index"><img width="25" height="25" src="https://img.icons8.com/color/48/checked--v1.png" alt="checked--v1" /> Applied</a>
                        }
                        else
                        {
                            <a asp-controller="SaveJob" asp-action="SaveJob" asp-route-id="@item.JobId" class="btn btn-primary mx-1 rounded">Save</a>
                            <a asp-controller="JobApplication" asp-action="CreateJobApplication" asp-route-id="@item.JobId" class="btn btn-success mx-1 rounded">Apply</a>
                        }
                    }
                </div>
            </div>
        </div>
    }
</div>

@functions {
    // Implement this function to check if the user has applied for a specific job
    bool CheckIfUserApplied(int jobId)
    {
        if (User.Identity.IsAuthenticated)
        {
            var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;

            // Example: Check if there's an existing job application for the user and job
            var existingApplication = _dbContext.JobApplications
                .FirstOrDefault(j => j.JobId == jobId && j.UserId == userId);

            return existingApplication != null;
        }

        return false;
    }
}
